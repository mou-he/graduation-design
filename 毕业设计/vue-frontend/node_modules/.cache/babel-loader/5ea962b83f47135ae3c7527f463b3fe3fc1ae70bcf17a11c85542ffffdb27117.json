{"ast":null,"code":"import { ref, nextTick, computed, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport api from '../utils/api';\nexport default {\n  name: 'AIChat',\n  setup() {\n    const sessions = ref({});\n    const currentSessionId = ref(null);\n    const tempSession = ref(false);\n    const currentMessages = ref([]);\n    const inputMessage = ref('');\n    const loading = ref(false);\n    const messagesRef = ref(null);\n    const messageInput = ref(null);\n    const selectedModel = ref('1');\n    const isStreaming = ref(false);\n    const renderMarkdown = text => {\n      if (!text && text !== '') return '';\n      return String(text).replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>').replace(/\\*(.*?)\\*/g, '<em>$1</em>').replace(/`(.*?)`/g, '<code>$1</code>').replace(/\\n/g, '<br>');\n    };\n    const playTTS = async text => {\n      try {\n        const response = await api.post('/chat/tts', {\n          text\n        });\n        if (response.data && response.data.status_code === 1000 && response.data.url) {\n          const audio = new Audio(response.data.url);\n          audio.play();\n        } else {\n          ElMessage.error('Êó†Ê≥ïËé∑ÂèñËØ≠Èü≥');\n        }\n      } catch (error) {\n        console.error('TTS error:', error);\n        ElMessage.error('ËØ∑Ê±ÇËØ≠Èü≥Êé•Âè£Â§±Ë¥•');\n      }\n    };\n    const loadSessions = async () => {\n      try {\n        const response = await api.get('/AI/chat/sessions');\n        if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.sessions)) {\n          const sessionMap = {};\n          response.data.sessions.forEach(s => {\n            const sid = String(s.sessionId);\n            sessionMap[sid] = {\n              id: sid,\n              name: s.name || `‰ºöËØù ${sid}`,\n              messages: [] // lazy load\n            };\n          });\n          sessions.value = sessionMap;\n        }\n      } catch (error) {\n        console.error('Load sessions error:', error);\n      }\n    };\n    const createNewSession = () => {\n      currentSessionId.value = 'temp';\n      tempSession.value = true;\n      currentMessages.value = [];\n      // focus input\n      nextTick(() => {\n        if (messageInput.value) messageInput.value.focus();\n      });\n    };\n    const switchSession = async sessionId => {\n      if (!sessionId) return;\n      currentSessionId.value = String(sessionId);\n      tempSession.value = false;\n\n      // lazy load history if not present\n      if (!sessions.value[sessionId].messages || sessions.value[sessionId].messages.length === 0) {\n        try {\n          const response = await api.post('/AI/chat/history', {\n            sessionId: currentSessionId.value\n          });\n          if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.history)) {\n            const messages = response.data.history.map(item => ({\n              role: item.is_user ? 'user' : 'assistant',\n              content: item.content\n            }));\n            sessions.value[sessionId].messages = messages;\n          }\n        } catch (err) {\n          console.error('Load history error:', err);\n        }\n      }\n      currentMessages.value = [...(sessions.value[sessionId].messages || [])];\n      await nextTick();\n      scrollToBottom();\n    };\n    const syncHistory = async () => {\n      if (!currentSessionId.value || tempSession.value) {\n        ElMessage.warning('ËØ∑ÈÄâÊã©Â∑≤Êúâ‰ºöËØùËøõË°åÂêåÊ≠•');\n        return;\n      }\n      try {\n        const response = await api.post('/AI/chat/history', {\n          sessionId: currentSessionId.value\n        });\n        if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.history)) {\n          const messages = response.data.history.map(item => ({\n            role: item.is_user ? 'user' : 'assistant',\n            content: item.content\n          }));\n          sessions.value[currentSessionId.value].messages = messages;\n          currentMessages.value = [...messages];\n          await nextTick();\n          scrollToBottom();\n        } else {\n          ElMessage.error('Êó†Ê≥ïËé∑ÂèñÂéÜÂè≤Êï∞ÊçÆ');\n        }\n      } catch (err) {\n        console.error('Sync history error:', err);\n        ElMessage.error('ËØ∑Ê±ÇÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•');\n      }\n    };\n    const sendMessage = async () => {\n      if (!inputMessage.value || !inputMessage.value.trim()) {\n        ElMessage.warning('ËØ∑ËæìÂÖ•Ê∂àÊÅØÂÜÖÂÆπ');\n        return;\n      }\n      const userMessage = {\n        role: 'user',\n        content: inputMessage.value\n      };\n      const currentInput = inputMessage.value;\n      inputMessage.value = '';\n      currentMessages.value.push(userMessage);\n      await nextTick();\n      scrollToBottom();\n      try {\n        loading.value = true;\n        if (isStreaming.value) {\n          await handleStreaming(currentInput);\n        } else {\n          await handleNormal(currentInput);\n        }\n      } catch (err) {\n        console.error('Send message error:', err);\n        ElMessage.error('ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');\n        if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value] && sessions.value[currentSessionId.value].messages) {\n          const sessionArr = sessions.value[currentSessionId.value].messages;\n          if (sessionArr && sessionArr.length) sessionArr.pop();\n        }\n        currentMessages.value.pop();\n      } finally {\n        if (!isStreaming.value) {\n          loading.value = false;\n        }\n        await nextTick();\n        scrollToBottom();\n      }\n    };\n    async function handleStreaming(question) {\n      const aiMessage = {\n        role: 'assistant',\n        content: '',\n        meta: {\n          status: 'streaming'\n        } // mark streaming\n      };\n      const aiMessageIndex = currentMessages.value.length;\n      currentMessages.value.push(aiMessage);\n      if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value]) {\n        if (!sessions.value[currentSessionId.value].messages) sessions.value[currentSessionId.value].messages = [];\n        sessions.value[currentSessionId.value].messages.push({\n          role: 'assistant',\n          content: ''\n        });\n      }\n      const url = tempSession.value ? '/api/AI/chat/send-stream-new-session' : '/api/AI/chat/send-stream';\n      const headers = {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`\n      };\n      const body = tempSession.value ? {\n        question: question,\n        modelType: selectedModel.value\n      } : {\n        question: question,\n        modelType: selectedModel.value,\n        sessionId: currentSessionId.value\n      };\n      try {\n        // ÂàõÂª∫ fetch ËøûÊé•ËØªÂèñ SSE ÊµÅ\n        const response = await fetch(url, {\n          method: 'POST',\n          headers,\n          body: JSON.stringify(body)\n        });\n        if (!response.ok) {\n          loading.value = false;\n          throw new Error('Network response was not ok');\n        }\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder();\n        let buffer = '';\n\n        // ËØªÂèñÊµÅÊï∞ÊçÆ\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) break;\n          const chunk = decoder.decode(value, {\n            stream: true\n          });\n          buffer += chunk;\n\n          // ÊåâË°åÂàÜÂâ≤\n          const lines = buffer.split('\\n');\n          buffer = lines.pop() || ''; // ‰øùÁïôÊú™ÂÆåÊàêÁöÑË°å\n\n          for (const line of lines) {\n            const trimmedLine = line.trim();\n            if (!trimmedLine) continue;\n\n            // Â§ÑÁêÜ SSE Ê†ºÂºèÔºödata: <content>\n            if (trimmedLine.startsWith('data:')) {\n              const data = trimmedLine.slice(5).trim();\n              console.log('[SSE] Received:', data); // Ë∞ÉËØïÊó•Âøó\n\n              if (data === '[DONE]') {\n                // ÊµÅÁªìÊùü\n                console.log('[SSE] Stream done');\n                loading.value = false;\n                currentMessages.value[aiMessageIndex].meta = {\n                  status: 'done'\n                };\n                currentMessages.value = [...currentMessages.value];\n              } else if (data.startsWith('{')) {\n                // Â∞ùËØïËß£Êûê JSONÔºàÂ¶Ç sessionIdÔºâ\n                try {\n                  const parsed = JSON.parse(data);\n                  if (parsed.sessionId) {\n                    const newSid = String(parsed.sessionId);\n                    console.log('[SSE] Session ID:', newSid);\n                    if (tempSession.value) {\n                      sessions.value[newSid] = {\n                        id: newSid,\n                        name: 'Êñ∞‰ºöËØù',\n                        messages: [...currentMessages.value]\n                      };\n                      currentSessionId.value = newSid;\n                      tempSession.value = false;\n                    }\n                  }\n                } catch (e) {\n                  // ‰∏çÊòØ JSONÔºåÂΩì‰ΩúÊôÆÈÄöÊñáÊú¨Â§ÑÁêÜ\n                  currentMessages.value[aiMessageIndex].content += data;\n                  console.log('[SSE] Content updated:', currentMessages.value[aiMessageIndex].content.length);\n                }\n              } else {\n                // ÊôÆÈÄöÊñáÊú¨Êï∞ÊçÆÔºåÁõ¥Êé•ËøΩÂä†\n                // ‰ΩøÁî®Êï∞ÁªÑÁ¥¢ÂºïÁõ¥Êé•Êõ¥Êñ∞ÔºåÂº∫Âà∂ Vue ÂìçÂ∫îÂºèÁ≥ªÁªüÊ£ÄÊµãÂèòÂåñ\n                currentMessages.value[aiMessageIndex].content += data;\n                console.log('[SSE] Content updated:', currentMessages.value[aiMessageIndex].content.length);\n              }\n\n              // ÊØèÊî∂Âà∞‰∏ÄÊù°Êï∞ÊçÆÂ∞±Á´ãÂç≥Êõ¥Êñ∞ DOM\n              // Âº∫Âà∂Êõ¥Êñ∞Êï¥‰∏™Êï∞ÁªÑ‰ª•Ëß¶ÂèëÂìçÂ∫îÂºè\n              currentMessages.value = [...currentMessages.value];\n\n              // ‰ΩøÁî® requestAnimationFrame Âº∫Âà∂ÊµèËßàÂô®ÈáçÊéí\n              await new Promise(resolve => {\n                requestAnimationFrame(() => {\n                  scrollToBottom();\n                  resolve();\n                });\n              });\n            }\n          }\n        }\n\n        // ÊµÅËØªÂèñÂÆåÊàêÂêéÁöÑÂ§ÑÁêÜ\n        loading.value = false;\n        currentMessages.value[aiMessageIndex].meta = {\n          status: 'done'\n        };\n        currentMessages.value = [...currentMessages.value];\n\n        // ÂêåÊ≠•Âà∞ sessions Â≠òÂÇ®\n        if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value]) {\n          const sessMsgs = sessions.value[currentSessionId.value].messages;\n          if (Array.isArray(sessMsgs) && sessMsgs.length) {\n            const lastIndex = sessMsgs.length - 1;\n            if (sessMsgs[lastIndex] && sessMsgs[lastIndex].role === 'assistant') {\n              sessMsgs[lastIndex].content = currentMessages.value[aiMessageIndex].content;\n            }\n          }\n        }\n      } catch (err) {\n        console.error('Stream error:', err);\n        loading.value = false;\n        currentMessages.value[aiMessageIndex].meta = {\n          status: 'error'\n        };\n        currentMessages.value = [...currentMessages.value];\n        ElMessage.error('ÊµÅÂºè‰º†ËæìÂá∫Èîô');\n      }\n    }\n    async function handleNormal(question) {\n      if (tempSession.value) {\n        const response = await api.post('/AI/chat/send-new-session', {\n          question: question,\n          modelType: selectedModel.value\n        });\n        if (response.data && response.data.status_code === 1000) {\n          const sessionId = String(response.data.sessionId);\n          const aiMessage = {\n            role: 'assistant',\n            content: response.data.Information || ''\n          };\n          sessions.value[sessionId] = {\n            id: sessionId,\n            name: 'Êñ∞‰ºöËØù',\n            messages: [{\n              role: 'user',\n              content: question\n            }, aiMessage]\n          };\n          currentSessionId.value = sessionId;\n          tempSession.value = false;\n          currentMessages.value = [...sessions.value[sessionId].messages];\n        } else {\n          ElMessage.error(response.data?.status_msg || 'ÂèëÈÄÅÂ§±Ë¥•');\n          currentMessages.value.pop();\n        }\n      } else {\n        const sessionMsgs = sessions.value[currentSessionId.value].messages;\n        sessionMsgs.push({\n          role: 'user',\n          content: question\n        });\n        const response = await api.post('/AI/chat/send', {\n          question: question,\n          modelType: selectedModel.value,\n          sessionId: currentSessionId.value\n        });\n        if (response.data && response.data.status_code === 1000) {\n          const aiMessage = {\n            role: 'assistant',\n            content: response.data.Information || ''\n          };\n          sessionMsgs.push(aiMessage);\n          currentMessages.value = [...sessionMsgs];\n        } else {\n          ElMessage.error(response.data?.status_msg || 'ÂèëÈÄÅÂ§±Ë¥•');\n          sessionMsgs.pop(); // rollback\n          currentMessages.value.pop();\n        }\n      }\n    }\n    const scrollToBottom = () => {\n      if (messagesRef.value) {\n        try {\n          messagesRef.value.scrollTop = messagesRef.value.scrollHeight;\n        } catch (e) {\n          // ignore\n        }\n      }\n    };\n    onMounted(() => {\n      loadSessions();\n    });\n\n    // expose to template\n    return {\n      sessions: computed(() => Object.values(sessions.value)),\n      currentSessionId,\n      tempSession,\n      currentMessages,\n      inputMessage,\n      loading,\n      messagesRef,\n      messageInput,\n      selectedModel,\n      isStreaming,\n      renderMarkdown,\n      playTTS,\n      createNewSession,\n      switchSession,\n      syncHistory,\n      sendMessage\n    };\n  }\n};","map":{"version":3,"names":["ref","nextTick","computed","onMounted","ElMessage","api","name","setup","sessions","currentSessionId","tempSession","currentMessages","inputMessage","loading","messagesRef","messageInput","selectedModel","isStreaming","renderMarkdown","text","String","replace","playTTS","response","post","data","status_code","url","audio","Audio","play","error","console","loadSessions","get","Array","isArray","sessionMap","forEach","s","sid","sessionId","id","messages","value","createNewSession","focus","switchSession","length","history","map","item","role","is_user","content","err","scrollToBottom","syncHistory","warning","sendMessage","trim","userMessage","currentInput","push","handleStreaming","handleNormal","sessionArr","pop","question","aiMessage","meta","status","aiMessageIndex","headers","localStorage","getItem","body","modelType","fetch","method","JSON","stringify","ok","Error","reader","getReader","decoder","TextDecoder","buffer","done","read","chunk","decode","stream","lines","split","line","trimmedLine","startsWith","slice","log","parsed","parse","newSid","e","Promise","resolve","requestAnimationFrame","sessMsgs","lastIndex","Information","status_msg","sessionMsgs","scrollTop","scrollHeight","Object","values"],"sources":["C:\\Users\\11395\\Desktop\\design-graduation\\ÊØï‰∏öËÆæËÆ°\\vue-frontend\\src\\views\\AIChat.vue"],"sourcesContent":["<template>\r\n  <div class=\"ai-chat-container\">\r\n    <!-- Â∑¶‰æß‰ºöËØùÂàóË°® -->\r\n    <div class=\"session-list\">\r\n      <div class=\"session-list-header\">\r\n        <span>‰ºöËØùÂàóË°®</span>\r\n        <button class=\"new-chat-btn\" @click=\"createNewSession\">Ôºã Êñ∞ËÅäÂ§©</button>\r\n      </div>\r\n      <ul class=\"session-list-ul\">\r\n        <li\r\n          v-for=\"session in sessions\"\r\n          :key=\"session.id\"\r\n          :class=\"['session-item', { active: currentSessionId === session.id }]\"\r\n          @click=\"switchSession(session.id)\"\r\n        >\r\n          {{ session.name || `‰ºöËØù ${session.id}` }}\r\n        </li>\r\n      </ul>\r\n    </div>\r\n\r\n    <!-- Âè≥‰æßËÅäÂ§©Âå∫Âüü -->\r\n    <div class=\"chat-section\">\r\n      <div class=\"top-bar\">\r\n        <button class=\"back-btn\" @click=\"$router.push('/menu')\">‚Üê ËøîÂõû</button>\r\n        <button class=\"sync-btn\" @click=\"syncHistory\" :disabled=\"!currentSessionId || tempSession\">ÂêåÊ≠•ÂéÜÂè≤Êï∞ÊçÆ</button>\r\n        <label for=\"modelType\">ÈÄâÊã©Ê®°ÂûãÔºö</label>\r\n        <select id=\"modelType\" v-model=\"selectedModel\" class=\"model-select\">\r\n          <option value=\"1\">ÈòøÈáåÁôæÁÇº</option>\r\n        </select>\r\n        <label for=\"streamingMode\" style=\"margin-left: 20px;\">\r\n          <input type=\"checkbox\" id=\"streamingMode\" v-model=\"isStreaming\" />\r\n          ÊµÅÂºèÂìçÂ∫î\r\n        </label>\r\n      </div>\r\n\r\n      <div class=\"chat-messages\" ref=\"messagesRef\">\r\n        <div\r\n          v-for=\"(message, index) in currentMessages\"\r\n          :key=\"index\"\r\n          :class=\"['message', message.role === 'user' ? 'user-message' : 'ai-message']\"\r\n        >\r\n          <div class=\"message-header\">\r\n            <b>{{ message.role === 'user' ? '‰Ω†' : 'AI' }}:</b>\r\n            <button v-if=\"message.role === 'assistant'\" class=\"tts-btn\" @click=\"playTTS(message.content)\">üîä</button>\r\n            <span v-if=\"message.meta && message.meta.status === 'streaming'\" class=\"streaming-indicator\"> ¬∑¬∑</span>\r\n          </div>\r\n          <div class=\"message-content\" v-html=\"renderMarkdown(message.content)\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-input\">\r\n        <textarea\r\n          v-model=\"inputMessage\"\r\n          placeholder=\"ËØ∑ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢ò...\"\r\n          @keydown.enter.exact.prevent=\"sendMessage\"\r\n          :disabled=\"loading\"\r\n          ref=\"messageInput\"\r\n          rows=\"1\"\r\n        ></textarea>\r\n        <button\r\n          type=\"button\"\r\n          :disabled=\"!inputMessage.trim() || loading\"\r\n          @click=\"sendMessage\"\r\n          class=\"send-btn\"\r\n        >\r\n          {{ loading ? 'ÂèëÈÄÅ‰∏≠...' : 'ÂèëÈÄÅ' }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n\r\nimport { ref, nextTick, computed, onMounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport api from '../utils/api'\r\n\r\nexport default {\r\n  name: 'AIChat',\r\n  setup() {\r\n\r\n    const sessions = ref({})               \r\n    const currentSessionId = ref(null)    \r\n    const tempSession = ref(false)        \r\n    const currentMessages = ref([])      \r\n    const inputMessage = ref('')\r\n    const loading = ref(false)\r\n    const messagesRef = ref(null)\r\n    const messageInput = ref(null)\r\n    const selectedModel = ref('1')\r\n    const isStreaming = ref(false)\r\n\r\n\r\n    const renderMarkdown = (text) => {\r\n      if (!text && text !== '') return ''\r\n      return String(text)\r\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n        .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n        .replace(/`(.*?)`/g, '<code>$1</code>')\r\n        .replace(/\\n/g, '<br>')\r\n    }\r\n\r\n    const playTTS = async (text) => {\r\n      try {\r\n        const response = await api.post('/chat/tts', { text })\r\n        if (response.data && response.data.status_code === 1000 && response.data.url) {\r\n          const audio = new Audio(response.data.url)\r\n          audio.play()\r\n        } else {\r\n          ElMessage.error('Êó†Ê≥ïËé∑ÂèñËØ≠Èü≥')\r\n        }\r\n      } catch (error) {\r\n        console.error('TTS error:', error)\r\n        ElMessage.error('ËØ∑Ê±ÇËØ≠Èü≥Êé•Âè£Â§±Ë¥•')\r\n      }\r\n    }\r\n\r\n    const loadSessions = async () => {\r\n      try {\r\n        const response = await api.get('/AI/chat/sessions')\r\n        if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.sessions)) {\r\n          const sessionMap = {}\r\n          response.data.sessions.forEach(s => {\r\n            const sid = String(s.sessionId)\r\n            sessionMap[sid] = {\r\n              id: sid,\r\n              name: s.name || `‰ºöËØù ${sid}`,\r\n              messages: [] // lazy load\r\n            }\r\n          })\r\n          sessions.value = sessionMap\r\n        }\r\n      } catch (error) {\r\n        console.error('Load sessions error:', error)\r\n      }\r\n    }\r\n\r\n    const createNewSession = () => {\r\n      currentSessionId.value = 'temp'\r\n      tempSession.value = true\r\n      currentMessages.value = []\r\n      // focus input\r\n      nextTick(() => {\r\n        if (messageInput.value) messageInput.value.focus()\r\n      })\r\n    }\r\n\r\n    const switchSession = async (sessionId) => {\r\n      if (!sessionId) return\r\n      currentSessionId.value = String(sessionId)\r\n      tempSession.value = false\r\n\r\n      // lazy load history if not present\r\n      if (!sessions.value[sessionId].messages || sessions.value[sessionId].messages.length === 0) {\r\n        try {\r\n          const response = await api.post('/AI/chat/history', { sessionId: currentSessionId.value })\r\n          if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.history)) {\r\n            const messages = response.data.history.map(item => ({\r\n              role: item.is_user ? 'user' : 'assistant',\r\n              content: item.content\r\n            }))\r\n            sessions.value[sessionId].messages = messages\r\n          }\r\n        } catch (err) {\r\n          console.error('Load history error:', err)\r\n        }\r\n      }\r\n\r\n\r\n      currentMessages.value = [...(sessions.value[sessionId].messages || [])]\r\n      await nextTick()\r\n      scrollToBottom()\r\n    }\r\n\r\n    const syncHistory = async () => {\r\n      if (!currentSessionId.value || tempSession.value) {\r\n        ElMessage.warning('ËØ∑ÈÄâÊã©Â∑≤Êúâ‰ºöËØùËøõË°åÂêåÊ≠•')\r\n        return\r\n      }\r\n      try {\r\n        const response = await api.post('/AI/chat/history', { sessionId: currentSessionId.value })\r\n        if (response.data && response.data.status_code === 1000 && Array.isArray(response.data.history)) {\r\n          const messages = response.data.history.map(item => ({\r\n            role: item.is_user ? 'user' : 'assistant',\r\n            content: item.content\r\n          }))\r\n          sessions.value[currentSessionId.value].messages = messages\r\n          currentMessages.value = [...messages]\r\n          await nextTick()\r\n          scrollToBottom()\r\n        } else {\r\n          ElMessage.error('Êó†Ê≥ïËé∑ÂèñÂéÜÂè≤Êï∞ÊçÆ')\r\n        }\r\n      } catch (err) {\r\n        console.error('Sync history error:', err)\r\n        ElMessage.error('ËØ∑Ê±ÇÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•')\r\n      }\r\n    }\r\n\r\n\r\n    const sendMessage = async () => {\r\n      if (!inputMessage.value || !inputMessage.value.trim()) {\r\n        ElMessage.warning('ËØ∑ËæìÂÖ•Ê∂àÊÅØÂÜÖÂÆπ')\r\n        return\r\n      }\r\n\r\n      const userMessage = {\r\n        role: 'user',\r\n        content: inputMessage.value\r\n      }\r\n      const currentInput = inputMessage.value\r\n      inputMessage.value = ''\r\n\r\n\r\n      currentMessages.value.push(userMessage)\r\n      await nextTick()\r\n      scrollToBottom()\r\n\r\n      try {\r\n        loading.value = true\r\n        if (isStreaming.value) {\r\n\r\n          await handleStreaming(currentInput)\r\n        } else {\r\n\r\n          await handleNormal(currentInput)\r\n        }\r\n      } catch (err) {\r\n        console.error('Send message error:', err)\r\n        ElMessage.error('ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï')\r\n\r\n        if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value] && sessions.value[currentSessionId.value].messages) {\r\n\r\n          const sessionArr = sessions.value[currentSessionId.value].messages\r\n          if (sessionArr && sessionArr.length) sessionArr.pop()\r\n        }\r\n        currentMessages.value.pop()\r\n      } finally {\r\n        if (!isStreaming.value) {\r\n          loading.value = false\r\n        }\r\n        await nextTick()\r\n        scrollToBottom()\r\n      }\r\n    }\r\n\r\n\r\n    async function handleStreaming(question) {\r\n\r\n      const aiMessage = {\r\n        role: 'assistant',\r\n        content: '',\r\n        meta: { status: 'streaming' } // mark streaming\r\n      }\r\n\r\n\r\n      const aiMessageIndex = currentMessages.value.length\r\n      currentMessages.value.push(aiMessage)\r\n\r\n      if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value]) {\r\n        if (!sessions.value[currentSessionId.value].messages) sessions.value[currentSessionId.value].messages = []\r\n        sessions.value[currentSessionId.value].messages.push({ role: 'assistant', content: '' })\r\n      }\r\n\r\n\r\n      const url = tempSession.value\r\n        ? '/api/AI/chat/send-stream-new-session'  \r\n        : '/api/AI/chat/send-stream'           \r\n\r\n      const headers = {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`\r\n      }\r\n\r\n      const body = tempSession.value\r\n        ? { question: question, modelType: selectedModel.value }\r\n        : { question: question, modelType: selectedModel.value, sessionId: currentSessionId.value }\r\n\r\n      try {\r\n        // ÂàõÂª∫ fetch ËøûÊé•ËØªÂèñ SSE ÊµÅ\r\n        const response = await fetch(url, {\r\n          method: 'POST',\r\n          headers,\r\n          body: JSON.stringify(body)\r\n        })\r\n\r\n        if (!response.ok) {\r\n          loading.value = false\r\n          throw new Error('Network response was not ok')\r\n        }\r\n\r\n        const reader = response.body.getReader()\r\n        const decoder = new TextDecoder()\r\n        let buffer = ''\r\n\r\n        // ËØªÂèñÊµÅÊï∞ÊçÆ\r\n        // eslint-disable-next-line no-constant-condition\r\n        while (true) {\r\n          const { done, value } = await reader.read()\r\n          if (done) break\r\n\r\n          const chunk = decoder.decode(value, { stream: true })\r\n          buffer += chunk\r\n\r\n          // ÊåâË°åÂàÜÂâ≤\r\n          const lines = buffer.split('\\n')\r\n          buffer = lines.pop() || '' // ‰øùÁïôÊú™ÂÆåÊàêÁöÑË°å\r\n\r\n          for (const line of lines) {\r\n            const trimmedLine = line.trim()\r\n            if (!trimmedLine) continue\r\n\r\n            // Â§ÑÁêÜ SSE Ê†ºÂºèÔºödata: <content>\r\n            if (trimmedLine.startsWith('data:')) {\r\n              const data = trimmedLine.slice(5).trim()\r\n              console.log('[SSE] Received:', data) // Ë∞ÉËØïÊó•Âøó\r\n\r\n              if (data === '[DONE]') {\r\n                // ÊµÅÁªìÊùü\r\n                console.log('[SSE] Stream done')\r\n                loading.value = false\r\n                currentMessages.value[aiMessageIndex].meta = { status: 'done' }\r\n                currentMessages.value = [...currentMessages.value]\r\n              } else if (data.startsWith('{')) {\r\n                // Â∞ùËØïËß£Êûê JSONÔºàÂ¶Ç sessionIdÔºâ\r\n                try {\r\n                  const parsed = JSON.parse(data)\r\n                  if (parsed.sessionId) {\r\n                    const newSid = String(parsed.sessionId)\r\n                    console.log('[SSE] Session ID:', newSid)\r\n                    if (tempSession.value) {\r\n                      sessions.value[newSid] = {\r\n                        id: newSid,\r\n                        name: 'Êñ∞‰ºöËØù',\r\n                        messages: [...currentMessages.value]\r\n                      }\r\n                      currentSessionId.value = newSid\r\n                      tempSession.value = false\r\n                    }\r\n                  }\r\n                } catch (e) {\r\n                  // ‰∏çÊòØ JSONÔºåÂΩì‰ΩúÊôÆÈÄöÊñáÊú¨Â§ÑÁêÜ\r\n                  currentMessages.value[aiMessageIndex].content += data\r\n                  console.log('[SSE] Content updated:', currentMessages.value[aiMessageIndex].content.length)\r\n                }\r\n              } else {\r\n                // ÊôÆÈÄöÊñáÊú¨Êï∞ÊçÆÔºåÁõ¥Êé•ËøΩÂä†\r\n                // ‰ΩøÁî®Êï∞ÁªÑÁ¥¢ÂºïÁõ¥Êé•Êõ¥Êñ∞ÔºåÂº∫Âà∂ Vue ÂìçÂ∫îÂºèÁ≥ªÁªüÊ£ÄÊµãÂèòÂåñ\r\n                currentMessages.value[aiMessageIndex].content += data\r\n                console.log('[SSE] Content updated:', currentMessages.value[aiMessageIndex].content.length)\r\n              }\r\n\r\n              // ÊØèÊî∂Âà∞‰∏ÄÊù°Êï∞ÊçÆÂ∞±Á´ãÂç≥Êõ¥Êñ∞ DOM\r\n              // Âº∫Âà∂Êõ¥Êñ∞Êï¥‰∏™Êï∞ÁªÑ‰ª•Ëß¶ÂèëÂìçÂ∫îÂºè\r\n              currentMessages.value = [...currentMessages.value]\r\n              \r\n              // ‰ΩøÁî® requestAnimationFrame Âº∫Âà∂ÊµèËßàÂô®ÈáçÊéí\r\n              await new Promise(resolve => {\r\n                requestAnimationFrame(() => {\r\n                  scrollToBottom()\r\n                  resolve()\r\n                })\r\n              })\r\n            }\r\n          }\r\n        }\r\n\r\n        // ÊµÅËØªÂèñÂÆåÊàêÂêéÁöÑÂ§ÑÁêÜ\r\n        loading.value = false\r\n        currentMessages.value[aiMessageIndex].meta = { status: 'done' }\r\n        currentMessages.value = [...currentMessages.value]\r\n\r\n        // ÂêåÊ≠•Âà∞ sessions Â≠òÂÇ®\r\n        if (!tempSession.value && currentSessionId.value && sessions.value[currentSessionId.value]) {\r\n          const sessMsgs = sessions.value[currentSessionId.value].messages\r\n          if (Array.isArray(sessMsgs) && sessMsgs.length) {\r\n            const lastIndex = sessMsgs.length - 1\r\n            if (sessMsgs[lastIndex] && sessMsgs[lastIndex].role === 'assistant') {\r\n              sessMsgs[lastIndex].content = currentMessages.value[aiMessageIndex].content\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Stream error:', err)\r\n        loading.value = false\r\n        currentMessages.value[aiMessageIndex].meta = { status: 'error' }\r\n        currentMessages.value = [...currentMessages.value]\r\n        ElMessage.error('ÊµÅÂºè‰º†ËæìÂá∫Èîô')\r\n      }\r\n    }\r\n\r\n\r\n    async function handleNormal(question) {\r\n      if (tempSession.value) {\r\n\r\n        const response = await api.post('/AI/chat/send-new-session', {\r\n          question: question,\r\n          modelType: selectedModel.value\r\n        })\r\n        if (response.data && response.data.status_code === 1000) {\r\n          const sessionId = String(response.data.sessionId)\r\n          const aiMessage = {\r\n            role: 'assistant',\r\n            content: response.data.Information || ''\r\n          }\r\n\r\n          sessions.value[sessionId] = {\r\n            id: sessionId,\r\n            name: 'Êñ∞‰ºöËØù',\r\n            messages: [ { role: 'user', content: question }, aiMessage ]\r\n          }\r\n          currentSessionId.value = sessionId\r\n          tempSession.value = false\r\n          currentMessages.value = [...sessions.value[sessionId].messages]\r\n        } else {\r\n          ElMessage.error(response.data?.status_msg || 'ÂèëÈÄÅÂ§±Ë¥•')\r\n\r\n          currentMessages.value.pop()\r\n        }\r\n      } else {\r\n\r\n        const sessionMsgs = sessions.value[currentSessionId.value].messages\r\n\r\n        sessionMsgs.push({ role: 'user', content: question })\r\n\r\n        const response = await api.post('/AI/chat/send', {\r\n          question: question,\r\n          modelType: selectedModel.value,\r\n          sessionId: currentSessionId.value\r\n        })\r\n        if (response.data && response.data.status_code === 1000) {\r\n          const aiMessage = { role: 'assistant', content: response.data.Information || '' }\r\n          sessionMsgs.push(aiMessage)\r\n          currentMessages.value = [...sessionMsgs]\r\n        } else {\r\n          ElMessage.error(response.data?.status_msg || 'ÂèëÈÄÅÂ§±Ë¥•')\r\n          sessionMsgs.pop() // rollback\r\n          currentMessages.value.pop()\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    const scrollToBottom = () => {\r\n      if (messagesRef.value) {\r\n        try {\r\n          messagesRef.value.scrollTop = messagesRef.value.scrollHeight\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n\r\n    onMounted(() => {\r\n      loadSessions()\r\n    })\r\n\r\n    // expose to template\r\n    return {\r\n      sessions: computed(() => Object.values(sessions.value)),\r\n      currentSessionId,\r\n      tempSession,\r\n      currentMessages,\r\n      inputMessage,\r\n      loading,\r\n      messagesRef,\r\n      messageInput,\r\n      selectedModel,\r\n      isStreaming,\r\n      renderMarkdown,\r\n      playTTS,\r\n      createNewSession,\r\n      switchSession,\r\n      syncHistory,\r\n      sendMessage\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.ai-chat-container {\r\n  height: 100vh;\r\n  display: flex;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  position: relative;\r\n  overflow: hidden;\r\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial;\r\n  color: #222;\r\n}\r\n\r\n.ai-chat-container::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"20\" cy=\"20\" r=\"2\" fill=\"rgba(255,255,255,0.08)\"/><circle cx=\"80\" cy=\"80\" r=\"2\" fill=\"rgba(255,255,255,0.08)\"/><circle cx=\"40\" cy=\"60\" r=\"1\" fill=\"rgba(255,255,255,0.06)\"/><circle cx=\"60\" cy=\"30\" r=\"1.5\" fill=\"rgba(255,255,255,0.06)\"/></svg>');\r\n  animation: float 20s ease-in-out infinite;\r\n  opacity: 0.25;\r\n}\r\n\r\n@keyframes float {\r\n  0%, 100% { transform: translateY(0px) rotate(0deg); }\r\n  50% { transform: translateY(-20px) rotate(180deg); }\r\n}\r\n\r\n.session-list {\r\n  width: 280px;\r\n  height: 100vh;\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background: rgba(255, 255, 255, 0.95);\r\n  backdrop-filter: blur(15px);\r\n  border-right: 1px solid rgba(0, 0, 0, 0.08);\r\n  box-shadow: 2px 0 20px rgba(0, 0, 0, 0.08);\r\n  position: relative;\r\n  z-index: 2;\r\n}\r\n\r\n.session-list-header {\r\n  padding: 20px;\r\n  text-align: center;\r\n  font-weight: 600;\r\n  background: linear-gradient(135deg, rgba(102, 126, 234, 0.06) 0%, rgba(103, 194, 58, 0.06) 100%);\r\n  border-bottom: 1px solid rgba(0, 0, 0, 0.06);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\r\n  align-items: center;\r\n}\r\n\r\n.new-chat-btn {\r\n  width: 100%;\r\n  padding: 12px 0;\r\n  cursor: pointer;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: white;\r\n  border: none;\r\n  border-radius: 12px;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.28);\r\n  transition: all 0.25s ease;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.new-chat-btn::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: -100%;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);\r\n  transition: left 0.5s;\r\n}\r\n\r\n.new-chat-btn:hover::before {\r\n  left: 100%;\r\n}\r\n\r\n.new-chat-btn:hover {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.36);\r\n}\r\n\r\n.session-list-ul {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n  flex: 1;\r\n  overflow-y: auto;\r\n}\r\n\r\n.session-item {\r\n  padding: 15px 20px;\r\n  cursor: pointer;\r\n  border-bottom: 1px solid rgba(0, 0, 0, 0.03);\r\n  transition: all 0.2s ease;\r\n  position: relative;\r\n  color: #2c3e50;\r\n}\r\n\r\n.session-item.active {\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: white;\r\n  font-weight: 600;\r\n  box-shadow: inset 0 0 20px rgba(102, 126, 234, 0.2);\r\n}\r\n\r\n.session-item:hover {\r\n  background: rgba(102, 126, 234, 0.06);\r\n  transform: translateX(4px);\r\n}\r\n\r\n/* chat section */\r\n.chat-section {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: relative;\r\n  z-index: 1;\r\n  min-width: 0;\r\n  min-height: 0;\r\n  overflow: hidden;\r\n}\r\n\r\n.top-bar {\r\n  background: rgba(255, 255, 255, 0.95);\r\n  backdrop-filter: blur(10px);\r\n  color: #2c3e50;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 12px 24px;\r\n  box-shadow: 0 2px 14px rgba(0, 0, 0, 0.06);\r\n  border-bottom: 1px solid rgba(0, 0, 0, 0.06);\r\n  gap: 12px;\r\n}\r\n\r\n.back-btn {\r\n  background: rgba(255, 255, 255, 0.22);\r\n  border: 1px solid rgba(0, 0, 0, 0.06);\r\n  color: #2c3e50;\r\n  padding: 8px 14px;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n  font-weight: 600;\r\n  transition: all 0.2s ease;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);\r\n}\r\n\r\n.back-btn:hover {\r\n  background: rgba(255, 255, 255, 0.32);\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.sync-btn {\r\n  background: linear-gradient(135deg, #67c23a 0%, #409eff 100%);\r\n  color: white;\r\n  padding: 8px 14px;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n  font-size: 13px;\r\n  font-weight: 600;\r\n  box-shadow: 0 4px 12px rgba(103, 194, 58, 0.2);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.sync-btn:disabled {\r\n  background: #ccc;\r\n  box-shadow: none;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.model-select {\r\n  margin-left: 6px;\r\n  padding: 6px 10px;\r\n  border: 1px solid rgba(0, 0, 0, 0.06);\r\n  border-radius: 8px;\r\n  background: white;\r\n  color: #2c3e50;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.chat-messages {\r\n  flex: 1;\r\n  min-height: 0;\r\n  overflow-y: auto;\r\n  padding: 30px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 18px;\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n/* scrollbar */\r\n.chat-messages::-webkit-scrollbar {\r\n  width: 8px;\r\n}\r\n.chat-messages::-webkit-scrollbar-thumb {\r\n  background: rgba(0,0,0,0.12);\r\n  border-radius: 8px;\r\n}\r\n.chat-messages::-webkit-scrollbar-track {\r\n  background: transparent;\r\n}\r\n\r\n.message {\r\n  max-width: 70%;\r\n  padding: 14px 18px;\r\n  border-radius: 18px;\r\n  line-height: 1.6;\r\n  word-wrap: break-word;\r\n  position: relative;\r\n  animation: messageSlideIn 0.28s ease-out;\r\n  font-size: 15px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n@keyframes messageSlideIn {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(12px) scale(0.98);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0) scale(1);\r\n  }\r\n}\r\n\r\n.user-message {\r\n  align-self: flex-end;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: white;\r\n  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.16);\r\n}\r\n\r\n.user-message::after {\r\n  content: '';\r\n  position: absolute;\r\n  bottom: -6px;\r\n  right: 18px;\r\n  width: 0;\r\n  height: 0;\r\n  border-left: 8px solid transparent;\r\n  border-right: 8px solid transparent;\r\n  border-top: 8px solid #764ba2;\r\n}\r\n\r\n.ai-message {\r\n  align-self: flex-start;\r\n  background: rgba(255, 255, 255, 0.95);\r\n  backdrop-filter: blur(4px);\r\n  color: #2c3e50;\r\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);\r\n  border: 1px solid rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.ai-message::after {\r\n  content: '';\r\n  position: absolute;\r\n  bottom: -6px;\r\n  left: 18px;\r\n  width: 0;\r\n  height: 0;\r\n  border-left: 8px solid transparent;\r\n  border-right: 8px solid transparent;\r\n  border-top: 8px solid rgba(255, 255, 255, 0.95);\r\n}\r\n\r\n.message-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.message-header b {\r\n  font-weight: 600;\r\n}\r\n\r\n.tts-btn {\r\n  padding: 6px 10px;\r\n  border-radius: 8px;\r\n  font-size: 12px;\r\n  cursor: pointer;\r\n  background: linear-gradient(135deg, #67c23a 0%, #409eff 100%);\r\n  color: white;\r\n  border: none;\r\n  transition: all 0.18s ease;\r\n  box-shadow: 0 2px 8px rgba(103, 194, 58, 0.18);\r\n}\r\n\r\n.tts-btn:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 4px 12px rgba(103, 194, 58, 0.25);\r\n}\r\n\r\n.streaming-indicator {\r\n  color: #999;\r\n  font-weight: 600;\r\n  margin-left: 6px;\r\n}\r\n\r\n/* message content */\r\n.message-content {\r\n  white-space: pre-wrap;\r\n  word-break: break-word;\r\n}\r\n\r\n/* input area */\r\n.chat-input {\r\n  padding: 24px;\r\n  background: rgba(255, 255, 255, 0.96);\r\n  backdrop-filter: blur(8px);\r\n  border-top: 1px solid rgba(0, 0, 0, 0.06);\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n.chat-input textarea {\r\n  width: 100%;\r\n  resize: none;\r\n  border: 2px solid rgba(0, 0, 0, 0.06);\r\n  border-radius: 12px;\r\n  padding: 14px 16px;\r\n  font-size: 15px;\r\n  outline: none;\r\n  background: rgba(255,255,255,0.96);\r\n  color: #2c3e50;\r\n  transition: all 0.18s ease;\r\n  min-height: 20px;\r\n  max-height: 160px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.04);\r\n}\r\n\r\n.chat-input textarea:focus {\r\n  border-color: #409eff;\r\n  box-shadow: 0 8px 30px rgba(64,158,255,0.06);\r\n  transform: translateY(-1px);\r\n}\r\n\r\n.send-btn {\r\n  position: absolute;\r\n  right: 36px;\r\n  bottom: 30px;\r\n  padding: 12px 22px;\r\n  border: none;\r\n  border-radius: 50px;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: white;\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  box-shadow: 0 6px 20px rgba(102,126,234,0.18);\r\n  transition: all 0.18s ease;\r\n}\r\n\r\n.send-btn:hover:not(:disabled) {\r\n  transform: translateY(-3px) scale(1.02);\r\n}\r\n\r\n.send-btn:disabled {\r\n  background: #ccc;\r\n  box-shadow: none;\r\n  cursor: not-allowed;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}